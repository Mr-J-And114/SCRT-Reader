<img width="1154" height="680" alt="image" src="https://github.com/user-attachments/assets/4bbf6245-3355-4815-8c7b-4a28571d2c5f" />


# SCRT-Reader 用户指南

**版本：V0.2.7**

---

## 目录

- [软件简介](#软件简介)
- [安装与启动](#安装与启动)
- [界面说明](#界面说明)
- [操作说明](#操作说明)
  - [两种模式](#两种模式)
  - [桌面模式](#桌面模式)
  - [磁盘模式](#磁盘模式)
  - [键盘与鼠标操作](#键盘与鼠标操作)
  - [主题切换](#主题切换)
  - [存档系统](#存档系统)
- [命令参考](#命令参考)
- [制作自己的故事包](#制作自己的故事包)
  - [概述](#概述)
  - [故事包文件结构](#故事包文件结构)
  - [manifest.json 详解](#manifestjson-详解)
  - [CRT-ML 标记语言](#crt-ml-标记语言)
  - [打字机控制标签](#打字机控制标签)
  - [完整示例](#完整示例)
  - [打包与测试](#打包与测试)

---

## 软件简介

**SCRT-Reader**（SCP CRT Reader）是一款基于 Godot 4.6 引擎开发的沉浸式终端风格文字阅读器。它模拟了一台上世纪 80-90 年代风格的 CRT 显示终端，通过命令行交互方式让用户阅读和探索故事内容。

软件围绕 **SCP 基金会**的世界观设计，但其故事包系统完全开放——任何人都可以制作自己的故事包，创造独特的交互式阅读体验。

### 核心特性

- **CRT 终端模拟**：逼真的扫描线、色差、荧光闪烁、噪点等 CRT 显示效果
- **打字机文字效果**：文字逐字显示，支持自定义速度和停顿控制
- **命令行交互**：通过输入命令浏览虚拟文件系统、阅读文件
- **权限解锁系统**：多级安全等级与密码认证机制，实现渐进式叙事
- **故事包系统**：故事内容以 `.scp`（或 `.zip`）文件形式加载，完全数据驱动
- **多主题支持**：内置磷光绿、琥珀色、冷蓝、纯白四种配色主题
- **自动存档**：进度自动保存，下次加载同一故事时恢复进度

---

## 安装与启动

### 导出版本（推荐）

1. 将 SCRT-Reader 可执行文件放在任意目录
2. 确保同一目录下存在 `vdisc/` 文件夹（首次运行会自动创建）
3. 将故事包文件（`.scp` 或 `.zip`）放入 `vdisc/` 文件夹
4. 双击可执行文件启动

目录结构示例：

```
SCRT-Reader/
├── SCRT-Reader.exe        (可执行文件)
├── vdisc/                 (故事包目录)
│   ├── my_story.scp
│   └── another_story.zip
└── saves/                 (存档目录，自动创建)
    └── save_xxxx.json
```

### 在 Godot 编辑器中运行

1. 使用 Godot 4.6 打开项目
2. 直接按 F5 运行
3. 故事包放在项目根目录的 `vdisc/` 文件夹内

---

## 界面说明

启动后，你将看到一个模拟 CRT 显示器的终端界面，由以下部分组成：

```
╔══════════════════════════════════════════╗
║ SCP TERMINAL | 桌面模式 | 磁盘: 2 [Mail]   ║  ← 状态栏
╠══════════════════════════════════════════╣
║                                          ║
║            [输出区域]                     ║
║   显示故事内容、命令反馈、系统信息           ║
║                                          ║
╠══════════════════════════════════════════╣
║ > _                                      ║  ← 输入区域
╚══════════════════════════════════════════╝
```

- **输出区域**：占据屏幕主体，显示文件内容、命令输出和系统信息
- **状态栏**：显示当前模式、路径、权限等级、邮件状态
- **输入区域**：底部的命令输入行，带闪烁方块光标

---

## 操作说明

### 两种模式

SCRT-Reader 有两种工作模式：

| 模式 | 说明 |
|------|------|
| **桌面模式** | 启动后的默认模式。可以浏览、扫描和加载 `vdisc/` 目录中的故事包 |
| **磁盘模式** | 加载故事包后进入。可以浏览虚拟文件系统、阅读文件、解锁权限 |

### 桌面模式

启动后自动进入桌面模式。屏幕会显示欢迎界面和已检测到的故事包列表：

```
╔══════════════════════════════════════╗
║   SCP FOUNDATION TERMINAL v0.1       ║
║     SECURE - CONTAIN - PROTECT       ║
╚══════════════════════════════════════╝

检测到 2 个虚拟磁盘:

  1. Site-19 事故调查
     SCRT测试 | test_story.scp
  2. 我的故事
     作者名 | my_story.scp
```

**桌面模式常用操作：**

- 输入 `load 1` 加载第 1 个故事包
- 输入 `scan` 重新扫描 `vdisc/` 目录（放入新文件后使用）
- 输入 `vdisc` 查看磁盘详细信息

### 磁盘模式

加载故事包后进入磁盘模式。此时你面对的是一个虚拟文件系统，通过命令浏览和阅读文件。

**基本工作流程：**

1. **`ls`** — 查看当前目录下有哪些文件和文件夹
2. **`cd <目录名>`** — 进入某个文件夹
3. **`open <文件名>`** — 打开并阅读某个文件
4. **`back`** — 返回上一级目录

**文件列表中的标记含义：**

| 标记 | 含义 |
|------|------|
| `[DIR]` 蓝色 | 可进入的目录 |
| `[FILE]` 绿色 | 可直接打开的文件 |
| `[DIR] 【LOCKED LV.N】` 红色 | 需要等级 N 权限才能进入的目录 |
| `[FILE] 【LOCKED LV.N】` 红色 | 需要等级 N 权限才能打开的文件 |
| `[FILE] [PASSWORD]` 黄色 | 需要输入文件专属密码才能打开 |

**解锁权限：**

当你遇到权限不足的文件或目录时，需要通过 `unlock` 命令输入密码来提升权限等级：

1. 输入 `unlock` 进入密码输入模式（密码输入时显示为 `*` 号）
2. 或直接输入 `unlock <密码>` 验证密码
3. 密码正确后权限等级会提升，之前锁定的内容会解锁
4. 在密码输入模式中输入 `cancel` 可取消

故事中的文件内容通常包含线索，引导你找到下一个密码。仔细阅读每个文件！

**文件密码：**

部分文件除了需要权限等级外，还设有独立的文件密码。打开这类文件时系统会提示输入密码并给出提示信息。

**卸载磁盘：**

- 输入 `eject` 卸载当前故事包并返回桌面模式（进度会自动保存）

### 键盘与鼠标操作

| 操作 | 说明 |
|------|------|
| `Enter` | 提交命令 |
| `↑` / `↓` | 浏览历史命令 |
| `Tab` | 自动补全命令和文件名 |
| `Space` / `Esc` | 跳过打字机动画，立即显示全部文字 |
| `PageUp` / `PageDown` | 上下滚动输出内容 |
| 鼠标滚轮 | 上下滚动输出内容 |
| 鼠标左键选中文字 + 右键 | 复制选中的文字到剪贴板 |

### 主题切换

输入 `theme` 命令可查看可用主题并切换。内置四种主题：

| 主题名 | 说明 |
|--------|------|
| `phosphor_green` | 经典磷光绿，默认主题，还原老式 CRT 终端的感觉 |
| `amber` | 复古琥珀色，模拟琥珀色单色显示器 |
| `cool_blue` | 冷蓝色调，现代终端风格 |
| `white` | 纯白高对比度 |

使用方法：`theme <主题名>`，例如 `theme amber`。

### 存档系统

- **自动保存**：每次解锁密码、阅读文件、卸载磁盘时自动保存
- **手动保存**：在磁盘模式下输入 `save`
- **清除存档**：
  - `clearsave` — 清除当前故事的存档
  - `clearsave all` — 清除全部存档

存档文件保存在程序目录下的 `saves/` 文件夹中，格式为 JSON。存档内容包括权限等级、已读文件列表、已解锁的密码等。再次加载同一故事时会自动恢复进度。

---

## 命令参考

### 通用命令（所有模式可用）

| 命令 | 说明 |
|------|------|
| `help` | 显示当前模式下的帮助信息 |
| `clear` / `cls` | 清空屏幕 |
| `scan` | 重新扫描 `vdisc/` 目录 |
| `vdisc` | 查看虚拟磁盘列表和详情 |
| `theme [主题名]` | 查看或切换颜色主题 |
| `clearsave [all]` | 清除存档 |
| `reboot` / `restart` | 重启终端 |
| `exit` / `quit` | 退出程序 |

### 桌面模式命令

| 命令 | 说明 |
|------|------|
| `load <编号>` | 加载指定编号的故事包 |

### 磁盘模式命令

| 命令 | 说明 |
|------|------|
| `ls` / `dir` | 列出当前目录下的文件和文件夹 |
| `cd <路径>` | 切换到指定目录（支持 `..` 和绝对路径） |
| `back` | 返回上一级目录 |
| `open <文件>` / `cat <文件>` | 打开并显示文件内容 |
| `status` | 查看用户状态（权限等级、已读文件数等） |
| `whoami` | 查看当前用户信息 |
| `mail` | 查看收件箱（后续版本实现） |
| `unlock [密码]` | 进入密码认证或直接验证密码 |
| `save` | 手动保存进度 |
| `eject` | 卸载当前磁盘，返回桌面模式 |

---

## 制作自己的故事包

### 概述

SCRT-Reader 的故事包是一个标准的 **ZIP 压缩文件**，扩展名改为 `.scp`（也可直接使用 `.zip`）。故事包中包含一个配置文件 `manifest.json` 和若干 `.txt` 文本文件，按文件夹组织成虚拟文件系统。

**制作故事包不需要任何编程知识**——你只需要：
1. 用文本编辑器编写故事内容（`.txt` 文件）
2. 编写一个 `manifest.json` 配置文件
3. 将所有文件打包为 ZIP 文件
4. 将 ZIP 文件放入 `vdisc/` 目录

### 故事包文件结构

一个典型的故事包内部结构如下：

```
my_story/                      (顶层文件夹，名称随意)
├── manifest.json              (必须) 故事配置文件
├── welcome.txt                故事入口/欢迎文件
├── notice.txt                 公告或提示
├── reports/                   (文件夹) 报告类文件
│   ├── report_001.txt
│   └── report_002.txt
├── personnel/                 (文件夹) 人员档案
│   ├── researcher_a.txt
│   └── agent_b.txt
├── classified/                (文件夹) 高密级文件
│   └── secret_doc.txt
└── comms/                     (文件夹) 通讯记录
    └── radio_log.txt
```

**注意事项：**
- 所有文本文件必须使用 **UTF-8 编码**
- 文件夹结构可以自由设计，没有固定要求
- `manifest.json` 必须存在，否则故事包无法被识别
- 如果 ZIP 内所有文件都在同一个顶层文件夹下，程序会自动去除该前缀（所以打包时套一层文件夹是可以的）

### manifest.json 详解

`manifest.json` 是故事包的核心配置文件，定义了故事元数据、权限系统和密码系统。

以下是完整的字段说明：

```json
{
  "story": {
    "id": "my_story_id",
    "title": "故事标题",
    "author": "作者名",
    "version": "1.0",
    "description": "故事简介（可选）"
  },

  "settings": {
    "start_path": "/",
    "start_clearance": 0,
    "typing_speed": 0.008
  },

  "permissions": {
    "/personnel/": 1,
    "/comms/": 2,
    "/classified/": 4,
    "/classified/secret_doc.txt": 5
  },

  "passwords": {
    "password1": {
      "grants_clearance": 1,
      "message": "密码验证成功后显示的提示信息"
    },
    "password2": {
      "grants_clearance": 3,
      "message": "恭喜，你获得了更高的权限。"
    }
  },

  "file_passwords": {
    "/classified/secret_doc.txt": {
      "password": "opensesame",
      "hint": "给用户的密码提示"
    }
  }
}
```

#### story（故事元数据）

| 字段 | 必须 | 说明 |
|------|------|------|
| `id` | 是 | 故事唯一标识符，用于存档关联。建议使用英文和下划线 |
| `title` | 是 | 故事标题，显示在桌面模式的磁盘列表中 |
| `author` | 是 | 作者名 |
| `version` | 否 | 版本号 |
| `description` | 否 | 故事简介 |

#### settings（运行设置）

| 字段 | 默认值 | 说明 |
|------|--------|------|
| `start_path` | `/` | 加载故事后的初始目录 |
| `start_clearance` | `0` | 玩家的初始权限等级 |
| `typing_speed` | `0.008` | 打字机效果的基础速度（秒/字符），数值越小越快 |

#### permissions（权限表）

定义哪些路径需要什么等级的权限才能访问。键为路径，值为所需权限等级（整数）。

规则：
- 路径支持精确匹配和目录前缀匹配
- 对目录设置权限（如 `/personnel/`）会自动保护该目录及其下所有文件
- 对单个文件设置权限（如 `/reports/secret.txt`）只保护该文件
- 权限等级数字越大表示越机密，从 0 开始，没有上限
- 没有出现在权限表中的路径，默认不需要任何权限

#### passwords（密码表）

定义可用的密码及其对应权限。玩家通过 `unlock` 命令输入密码来提升权限等级。

| 字段 | 说明 |
|------|------|
| 键（如 `"password1"`） | 密码字符串本身（区分大小写） |
| `grants_clearance` | 输入此密码后将权限提升到的等级 |
| `message` | 密码验证成功后显示的提示信息（可选） |

设计建议：
- 在低权限文件中设置线索，引导玩家猜出密码
- 密码按权限等级递增设计，形成渐进式解锁流程
- 每个密码只能使用一次，且只有当对应等级高于当前等级时才生效

#### file_passwords（文件密码表）

为特定文件设置独立的密码保护。与权限系统独立——即使玩家有足够的权限等级，仍需额外输入文件密码才能查看内容。

| 字段 | 说明 |
|------|------|
| 键（如 `"/reports/file.txt"`） | 需要密码保护的文件路径 |
| `password` | 正确的密码 |
| `hint` | 打开文件时显示给用户的密码提示 |

### CRT-ML 标记语言

故事文件（`.txt`）中可以使用 **CRT-ML** 标记语言来增强文本的视觉效果。CRT-ML 是 SCRT-Reader 专用的轻量级标记语法，会在显示时自动转换为富文本格式。

#### SCP 专用标记

| 标记 | 效果 | 说明 |
|------|------|------|
| `[REDACTED]` | ██████████ | 黑底黑字遮挡效果（默认长度） |
| `[REDACTED:被隐藏的文字]` | ████████ | 根据指定文字长度生成遮挡块 |
| `[DATA EXPUNGED]` | ~~DATA EXPUNGED~~ | 红色删除线效果 |

#### 格式标记

| 标记 | 效果 | 说明 |
|------|------|------|
| `{header}标题{/header}` | **大号加粗标题** | 一级标题（24pt） |
| `{header:2}标题{/header}` | **中号加粗标题** | 二级标题（20pt） |
| `{header:3}标题{/header}` | **小号加粗标题** | 三级标题（16pt） |
| `{separator}` 或 `{hr}` | ──────── | 水平分隔线 |
| `{bold}文字{/bold}` | **粗体文字** | 也可简写为 `{b}...{/b}` |
| `{italic}文字{/italic}` | *斜体文字* | 也可简写为 `{i}...{/i}` |

#### 颜色标记

```
{color:颜色名}文字内容{/color}
```

支持的颜色名：

| 颜色名 | 别名 | 说明 |
|--------|------|------|
| `primary` | — | 主色调（随主题变化） |
| `error` | `red` | 红色/错误色 |
| `warning` | `yellow` | 黄色/警告色 |
| `success` | `green` | 绿色/成功色 |
| `info` | `blue` | 蓝色/信息色 |
| `muted` | `gray` / `grey` | 灰色/注释色 |

也支持自定义十六进制颜色：`{color:#FF5533}文字{/color}`

#### 机密标记框

```
{classified:等级}
文件内容...
{/classified}
```

生成带边框的机密文件样式。等级 1-3 为黄色边框，等级 4 及以上为红色边框。

示例效果：
```
╔══ CLASSIFIED LEVEL 4 ══╗
这里是高度机密的内容...
╚═══════════════════════╝
```

#### 故障效果

```
{glitch}文字内容{/glitch}
```

文字会以红色波浪动画效果显示，模拟数据损坏/信号干扰的视觉效果。

### 打字机控制标签

在文本中可以嵌入特殊标签来控制打字机的输出节奏：

| 标签 | 说明 | 示例 |
|------|------|------|
| `[speed=数值]` | 设置打字速度（秒/字符） | `[speed=0.05]缓慢显示的文字[/speed]` |
| `[/speed]` | 恢复默认打字速度 | — |
| `[pause=数值]` | 在此处暂停指定秒数 | `等一下……[pause=2.0]好了。` |

使用技巧：
- 数值越大，打字速度越慢。默认值为 `0.008`
- 在悬念处使用 `[pause=1.0]` 可以增强叙事节奏感
- 对重要内容使用 `[speed=0.03]` 放慢显示速度，吸引注意力

### 完整示例

下面是一个最小但完整的故事包示例：

#### 目录结构

```
my_first_story/
├── manifest.json
├── welcome.txt
├── logs/
│   ├── log_001.txt
│   └── log_002.txt
└── secret/
    └── truth.txt
```

#### manifest.json

```json
{
  "story": {
    "id": "my_first_story",
    "title": "我的第一个故事",
    "author": "你的名字",
    "version": "1.0",
    "description": "一个简单的示例故事包"
  },
  "settings": {
    "start_path": "/",
    "start_clearance": 0,
    "typing_speed": 0.008
  },
  "permissions": {
    "/logs/log_002.txt": 1,
    "/secret/": 2
  },
  "passwords": {
    "alpha": {
      "grants_clearance": 1,
      "message": "一级权限已授予。你现在可以查看更多日志了。"
    },
    "omega": {
      "grants_clearance": 2,
      "message": "最高权限已授予。机密档案已解锁。"
    }
  },
  "file_passwords": {
    "/secret/truth.txt": {
      "password": "finalkey",
      "hint": "答案就在 log_002 的最后一行"
    }
  }
}
```

#### welcome.txt

```
{header}欢迎访问研究站终端系统{/header}

{separator}

本终端已授权用于查阅站点内部资料。

{color:warning}注意：部分文件需要更高权限才能访问。{/color}

当前可用操作：
- 输入 {bold}help{/bold} 查看所有命令
- 输入 {bold}ls{/bold} 浏览当前目录
- 输入 {bold}unlock{/bold} 进行密码认证

{separator}

{color:muted}提示：试试查看 logs 目录中的文件，也许能找到有用的信息。
第一个密码与希腊字母有关……{/color}
```

#### logs/log_001.txt

```
{header:2}研究日志 #001{/header}

日期：2024-03-15
记录人：Dr. Smith

{separator}

今天的实验进展顺利。[REDACTED:测试样本] 表现出了预期的反应。

初步数据表明 {color:success}假说成立{/color}，但还需要进一步验证。

{color:muted}备注：实验数据已归档至 log_002，但该文件已被设置为一级权限。
通关密码是第一个希腊字母的英文拼写。{/color}
```

#### logs/log_002.txt

```
{header:2}研究日志 #002{/header}

日期：2024-03-22
记录人：Dr. Smith

{separator}

{classified:1}
实验已进入最终阶段。
[DATA EXPUNGED] 的异常现象仍在持续。
我们必须在情况失控之前采取行动。
{/classified}

[pause=1.0]

[speed=0.03]如果你正在读到这段文字……说明事情已经发生了。[/speed]

{color:error}机密文件夹的访问密码是最后一个希腊字母。{/color}

{color:muted}最终报告中的密码是：finalkey{/color}
```

#### secret/truth.txt

```
{header}最终报告{/header}

{classified:4}

{color:error}{bold}绝密 - 仅限最高权限人员查阅{/bold}{/color}

{separator}

{glitch}真相从未被掩埋，只是没有人愿意去寻找。{/glitch}

[pause=2.0]

[speed=0.05]感谢你坚持到最后。

故事到此结束。[/speed]

{separator}

{color:muted}—— END OF FILE ——{/color}

{/classified}
```

### 打包与测试

#### 打包步骤

1. **准备文件**：确保所有 `.txt` 文件使用 UTF-8 编码保存

2. **创建 ZIP 文件**：
   - **Windows**：选中故事文件夹，右键 → 发送到 → 压缩(zipped)文件夹
   - **macOS**：选中故事文件夹，右键 → 压缩
   - **Linux**：`zip -r my_story.scp my_first_story/`

3. **修改扩展名**（可选）：将 `.zip` 改为 `.scp`。两种扩展名都能被识别

4. **放入 vdisc 目录**：将打包好的文件复制到 SCRT-Reader 同级目录的 `vdisc/` 文件夹中

#### 测试

1. 启动 SCRT-Reader
2. 如果之前已经启动，输入 `scan` 重新扫描磁盘
3. 确认你的故事出现在列表中
4. 使用 `load <编号>` 加载你的故事
5. 逐一测试以下内容：
   - 所有文件是否可以正常打开和显示
   - CRT-ML 标记是否正确渲染
   - 权限系统是否按预期工作
   - 密码是否能正确解锁对应等级
   - 文件密码是否正常提示和验证
   - 存档和读档是否正常

#### 常见问题排查

| 问题 | 可能原因 |
|------|----------|
| 故事包不出现在列表中 | 文件不在 `vdisc/` 目录中，或扩展名不是 `.scp`/`.zip` |
| 加载后没有文件 | `manifest.json` 格式错误或不存在。检查 JSON 语法是否正确 |
| 中文显示为乱码 | 文本文件未使用 UTF-8 编码保存 |
| 权限设置不生效 | 检查 `permissions` 中的路径是否以 `/` 开头，目录路径是否以 `/` 结尾 |
| CRT-ML 标记显示为原始文本 | 检查标记语法，注意使用花括号 `{}` 而非方括号 `[]`（SCP 标记除外） |

---

*本指南适用于 SCRT-Reader V0.2.7 版本。*
